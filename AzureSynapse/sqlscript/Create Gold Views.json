{
	"name": "Create Gold Views",
	"properties": {
		"content": {
			"query": "-- viweing column names in ball_by_ball\nSELECT\n    COLUMN_NAME,\n    DATA_TYPE\nFROM INFORMATION_SCHEMA.COLUMNS\nWHERE TABLE_SCHEMA = 'gold'\n  AND TABLE_NAME = 'ball_by_ball'\nORDER BY ORDINAL_POSITION;\n\n---- Aggregates ball-by-ball data to find total runs scored by each player per season\nCREATE OR ALTER VIEW gold.top_scoring_batsmen_per_season AS\nSELECT\n    p.player_name,\n    m.season_year,\n    SUM(b.runs_scored) AS total_runs\nFROM gold.ball_by_ball b\nJOIN gold.match m\n    ON b.match_id = m.match_id\nJOIN gold.player_match pm\n    ON m.match_id = pm.match_id\n   AND b.striker = pm.player_id\nJOIN gold.player p\n    ON p.player_id = pm.player_id\nGROUP BY\n    p.player_name,\n    m.season_year;\n\n-- Analyzes powerplay bowling performance by country based on economy and wickets\nSELECT\n    p.country_name,\n    p.player_name,\n    AVG(b.runs_scored) AS avg_runs_per_ball,\n    SUM(CASE WHEN b.bowler_wicket = 1 THEN 1 ELSE 0 END) AS total_wickets\nFROM gold.ball_by_ball b\nJOIN gold.player_match pm\n    ON b.match_id = pm.match_id\n   AND b.bowler = pm.player_id\nJOIN gold.player p\n    ON pm.player_id = p.player_id\nWHERE b.over_id <= 6\nGROUP BY\n    p.country_name,\n    p.player_name\nORDER BY\n    avg_runs_per_ball ASC,\n    total_wickets DESC;\n\n-- Evaluates whether the toss winner won or lost each individual match\nSELECT\n    m.match_id,\n    m.toss_winner,\n    m.toss_name,\n    m.match_winner,\n    CASE\n        WHEN m.toss_winner = m.match_winner THEN 'Won'\n        ELSE 'Lost'\n    END AS match_outcome\nFROM gold.match m\nWHERE m.toss_name IS NOT NULL\nORDER BY m.match_id;\n\n--Win percentage of teams per season, based on toss outcome\nSELECT\n    toss_winner AS team_name,\n    season_year,\n    CAST(\n        100.0 * COUNT(CASE WHEN toss_winner = match_winner THEN 1 END)\n        / COUNT(*)\n        AS DECIMAL(6,2)\n    ) AS win_percentage\nFROM gold.match\nWHERE toss_winner IS NOT NULL\nGROUP BY\n    toss_winner,\n    season_year\nORDER BY\n    season_year,\n    win_percentage DESC;\n\n-- Calculates average runs scored per ball by players in matches their team won\nSELECT\n    p.player_name,\n    AVG(b.runs_scored) AS avg_runs_in_wins,\n    COUNT(*) AS balls_faced\nFROM gold.ball_by_ball b\nJOIN gold.player_match pm\n    ON b.match_id = pm.match_id\n   AND b.striker = pm.player_id\nJOIN gold.player p\n    ON pm.player_id = p.player_id\nJOIN gold.match m\n    ON pm.match_id = m.match_id\nWHERE m.match_winner = pm.player_team\nGROUP BY\n    p.player_name\nORDER BY\n    avg_runs_in_wins ASC;\n\n-- Calculates average and highest match scores for each venue\nSELECT\n    venue_name,\n    AVG(total_runs) AS average_score,\n    MAX(total_runs) AS highest_score\nFROM (\n    SELECT\n        b.match_id,\n        m.venue_name,\n        SUM(b.runs_scored + b.extra_runs) AS total_runs\n    FROM gold.ball_by_ball b\n    JOIN gold.match m\n        ON b.match_id = m.match_id\n    GROUP BY\n        b.match_id,\n        m.venue_name\n) t\nGROUP BY\n    venue_name\nORDER BY\n    average_score DESC;\n\n-- Counts how often each type of dismissal occurs in IPL matches\nSELECT\n    out_type,\n    COUNT(*) AS frequency\nFROM gold.ball_by_ball\nWHERE out_type IS NOT NULL\nGROUP BY\n    out_type\nORDER BY\n    frequency DESC;\n\n-- Shows season-wise match wins for Team1 after winning the toss\nSELECT\n    team1 AS team_name,\n    season_year,\n    COUNT(*) AS matches_played,\n    SUM(\n        CASE \n            WHEN toss_winner = match_winner THEN 1 \n            ELSE 0 \n        END\n    ) AS wins_after_toss\nFROM gold.match\nWHERE toss_winner = team1\nGROUP BY\n    team1,\n    season_year\nORDER BY\n    season_year,\n    wins_after_toss DESC;\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "iplanalysis",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}